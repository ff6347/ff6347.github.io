---
import type { CollectionEntry } from "astro:content";
import { getCollection } from "astro:content";
import BlogLayout from "../../layouts/post.astro";
import { normalizeTagForUrl } from "../../lib/tags";

export async function getStaticPaths() {
	const posts = await getCollection("blog");
	return posts.map((post) => ({
		params: { slug: post.slug },
		props: post,
	}));
}
type Props = CollectionEntry<"blog">;

const post = Astro.props;
const { title, pubDate, description, tags, updateDate } = post.data;

const { Content } = await post.render();
---

<BlogLayout title={title}>
	<published-date>
		<span>Published on &ndash;</span>
		<time datetime={pubDate.toISOString()} class="post-date">
			{pubDate.toISOString().split("T")[0]}
		</time>
	</published-date>
	{
		updateDate && (
			<updated-on>
				<span> | Updated on &ndash;</span>
				<time datetime={updateDate.toISOString()} class="post-update-date">
					{updateDate.toISOString().split("T")[0]}
				</time>
			</updated-on>
		)
	}

	<used-tags>
		{
			tags && tags.length > 0 && (
				<div class="post-tags">
					<span class="tags-label">Tagged &ndash;</span>
					{tags.map((tag: string) => (
						<a href={`/blog/tags/${normalizeTagForUrl(tag)}`} class="tag-badge">
							{tag}
						</a>
					))}
				</div>
			)
		}
	</used-tags>
	<tl-dr>
		{description && <p class="post-description">tl;dr &ndash; {description}</p>}
	</tl-dr>
	<hr />
	<Content />
</BlogLayout>

<style>
	published-date,
	updated-on,
	tl-dr,
	used-tags {
		font-style: italic;
	}
</style>

<style>
	.post-tags {
		display: flex;
		flex-wrap: wrap;
		align-items: baseline;
		gap: 0.5rem;
		margin: 0 0 1.5rem 0;
		font-size: 0.9em;
	}

	.tags-label {
		color: var(--text-color-light);
		font-weight: normal;
	}

	.tag-badge {
		padding: 0.1rem 0.4rem;
		background: var(--bg-color-secondary, #f5f5f5);
		border-radius: 3px;
		text-decoration: none;
		color: var(--text-color-light);
	}

	.tag-badge:hover {
		text-decoration: underline;
	}
</style>
